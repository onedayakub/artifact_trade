at_artifacts_window_get_all_artifacts_effect = {
	at_clear_variable_list_and_reset_count = {
		LIST = at_artifacts_window_all_artifacts
		COUNT = at_artifacts_window_total_count
	}
	if = {
		limit = { scope:flavor = flag:sell }
		every_character_artifact = {
			ROOT = {
				at_add_to_variable_list_and_increment_count = {
					LIST = at_artifacts_window_all_artifacts
					COUNT = at_artifacts_window_total_count
				}
			}
		}
	}
	else_if = {
		limit = { scope:flavor = flag:buy }
		at_get_valid_buyers_or_sellers_effect = { LIST = valid_buyers }
		every_in_list = {
			list = valid_buyers
			limit = {
				at_candidate_to_sell_artifact_to_trigger = { PARTY = ROOT }
			}
			every_character_artifact = {
				ROOT = {
					at_add_to_variable_list_and_increment_count = {
						LIST = at_artifacts_window_all_artifacts
						COUNT = at_artifacts_window_total_count
					}
				}
			}
		}
	}
	else = {
		every_artifact = {
			ROOT = {
				at_add_to_variable_list_and_increment_count = {
					LIST = at_artifacts_window_all_artifacts
					COUNT = at_artifacts_window_total_count
				}
			}
		}
	}
}

at_artifacts_window_get_artifacts_effect = {
	at_clear_variable_list_and_reset_count = {
		LIST = at_artifacts_window_artifacts
		COUNT = at_artifacts_window_count
	}
	ordered_in_list = {
		variable = at_artifacts_window_all_artifacts
		order_by = {
			if = {
				limit = { ROOT.var:at_artifacts_window_selected_artifact_sort_option = flag:_rarity }
				value = artifact_rarity
			}
			else_if = {
				limit = { ROOT.var:at_artifacts_window_selected_artifact_sort_option = flag:_durability }
				value = artifact_durability
			}
			else_if = {
				limit = { ROOT.var:at_artifacts_window_selected_artifact_sort_option = flag:_type }
				value = at_artifact_type_value
			}
			else_if = {
				limit = { ROOT.var:at_artifacts_window_selected_artifact_sort_option = flag:_price }
				value = at_artifact_base_price_value
			}
			if = {
				limit = {
					ROOT = { has_variable = at_artifacts_window_is_artifact_sort_order_ascending }
				}
				multiply = -1
			}
		}
		max = 10000
		check_range_bounds = no

		ROOT = {
			at_add_to_variable_list_and_increment_count = {
				LIST = at_artifacts_window_artifacts
				COUNT = at_artifacts_window_count
			}
		}
	}
}

at_clear_variable_list_and_reset_count = {
	clear_variable_list = $LIST$
	set_variable = {
		name = $COUNT$
		value = 0
	}
}

at_add_to_variable_list_and_increment_count = {
	add_to_variable_list = {
		name = $LIST$
		target = PREV
	}
	set_variable = {
		name = $COUNT$
		value = {
			value = var:$COUNT$
			add = 1
		}
	}
}