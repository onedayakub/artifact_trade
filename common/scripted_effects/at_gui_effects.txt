at_artifacts_window_get_all_artifacts_effect = {
	clear_global_variable_list = at_artifacts_window_all_artifacts
	if = {
		limit = { scope:flavor = flag:sell }
		at_get_valid_buyers_or_sellers_effect = { LIST = valid_buyers }
		every_character_artifact = {
			limit = {
				is_equipped = no
				save_temporary_scope_as = artifact
				any_in_list = {
					list = valid_buyers
					at_candidate_to_sell_artifact_to_trigger = { PARTY = ROOT }
					save_temporary_opinion_value_as = {
						name = opinion_of_actor
						target = ROOT
					}
					at_sell_artifact_ai_accept_value > 0
				}
			}
			add_to_global_variable_list = {
				name = at_artifacts_window_all_artifacts
				target = this
			}
		}
	}
	else_if = {
		limit = { scope:flavor = flag:buy }
		at_get_valid_buyers_or_sellers_effect = { LIST = valid_sellers }
		every_in_list = {
			list = valid_sellers
			limit = {
				at_candidate_to_buy_artifact_from_trigger = { PARTY = ROOT }
			}
			every_character_artifact = {
				# TODO Filter only buyable artifacts
				add_to_global_variable_list = {
					name = at_artifacts_window_all_artifacts
					target = this
				}
			}
		}
	}
	else = {
		every_artifact = {
			add_to_global_variable_list = {
				name = at_artifacts_window_all_artifacts
				target = this
			}
		}
	}
}

at_artifacts_window_get_artifacts_effect = {
	clear_global_variable_list = at_artifacts_window_artifacts
	ordered_in_global_list = {
		variable = at_artifacts_window_all_artifacts
		order_by = {
			if = {
				limit = { global_var:at_artifacts_window_selected_artifact_sort_option = flag:_rarity }
				value = artifact_rarity
			}
			else_if = {
				limit = { global_var:at_artifacts_window_selected_artifact_sort_option = flag:_durability }
				value = artifact_durability
			}
			else_if = {
				limit = { global_var:at_artifacts_window_selected_artifact_sort_option = flag:_type }
				value = at_artifact_type_value
			}
			else_if = {
				limit = { global_var:at_artifacts_window_selected_artifact_sort_option = flag:_price }
				value = at_artifact_base_price_value
			}
			if = {
				limit = {
					has_global_variable = at_artifacts_window_is_artifact_sort_order_ascending
				}
				multiply = -1
			}
		}
		max = 10000
		check_range_bounds = no

		add_to_global_variable_list = {
			name = at_artifacts_window_artifacts
			target = this
		}
	}
}
